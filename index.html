<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>EczaPlus - Eczane Yönetim Sistemi</title>
    <link href="assets/dist/css/bundle.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/tebeos-theme.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <!-- TEBEOS Style Splash Screen -->
    <div class="tebeos-splash splash loading">
        <img src="assets/images/logo.svg" />
        <h1>EczaPlus</h1>
        <div class="loading-text"><i class="fa fa-spinner fa-spin"></i> Lütfen bekleyin...</div>
    </div>

    <!-- TEBEOS Style Login Page -->
    <div id="login" class="tebeos-login-page">
        <div class="tebeos-login-box">
            <div class="logo">
                <img src="assets/images/logo.svg" />
                <h2>EczaPlus Giriş</h2>
            </div>
            <form id="account">
                <div class="form-group">
                    <label>Kullanıcı Adı</label>
                    <input type="text" placeholder="Kullanıcı adınızı girin" name="username">
                </div>
                <div class="form-group">
                    <label>Şifre</label>
                    <input type="password" placeholder="Şifrenizi girin" name="password">
                </div>
                <button type="submit">Giriş Yap</button>
            </form>
        </div>
    </div>

    <div id="main_app">
        <!-- TEBEOS Title Bar -->
        <div class="tebeos-titlebar">
            <div class="app-title">
                <img src="assets/images/logo.svg" alt="EczaPlus" />
                <span>EczaPlus</span>
                <span class="app-version">| v1.0.0</span>
            </div>
            <div class="user-info">
                <span>Aktif Kullanıcı: <strong id="loggedin-user"></strong></span>
                <button id="log-out" class="tebeos-btn tebeos-btn-danger" style="padding: 3px 10px; font-size: 11px;">
                    <i class="glyphicon glyphicon-log-out"></i> Çıkış
                </button>
            </div>
        </div>

        <!-- TEBEOS Menu Bar -->
        <div class="tebeos-menubar">
            <div class="menu-item dropdown">
                <span data-toggle="dropdown">Hızlı Menü <i class="fa fa-caret-down"></i></span>
                <ul class="dropdown-menu tebeos-dropdown">
                    <li><a href="#" id="pointofsale-menu">Nakit Satış</a></li>
                    <li><a href="#" id="transactions-menu">Tüm İşlemler</a></li>
                    <li class="divider"></li>
                    <li><a href="#" data-toggle="modal" data-target="#holdOrdersModal">Açık Sekmeler</a></li>
                </ul>
            </div>
            <div class="menu-item dropdown">
                <span data-toggle="dropdown">Alış <i class="fa fa-caret-down"></i></span>
                <ul class="dropdown-menu tebeos-dropdown">
                    <li><a href="#" data-toggle="modal" data-target="#newProduct">Yeni Ürün Girişi</a></li>
                    <li><a href="#" data-toggle="modal" data-target="#Products">Ürün Listesi</a></li>
                </ul>
            </div>
            <div class="menu-item dropdown">
                <span data-toggle="dropdown">Satış <i class="fa fa-caret-down"></i></span>
                <ul class="dropdown-menu tebeos-dropdown">
                    <li><a href="#" id="pos-menu-nakit">Nakit Satış</a></li>
                    <li><a href="#" id="pos-menu-all">Tüm Satışlar</a></li>
                    <li class="divider"></li>
                    <li><a href="#" data-toggle="modal" data-target="#customerModal" onclick="$(this).getCustomerOrders()">Müşteri Siparişleri</a></li>
                </ul>
            </div>
            <div class="menu-item dropdown">
                <span data-toggle="dropdown">Stok & Sayım <i class="fa fa-caret-down"></i></span>
                <ul class="dropdown-menu tebeos-dropdown">
                    <li><a href="#" data-toggle="modal" data-target="#Products">Stok Listesi</a></li>
                    <li><a href="#" data-toggle="modal" data-target="#Categories">Kategoriler</a></li>
                    <li class="divider"></li>
                    <li><a href="#" data-toggle="modal" data-target="#newProduct">Ürün Ekle</a></li>
                    <li><a href="#" data-toggle="modal" data-target="#newCategory">Kategori Ekle</a></li>
                </ul>
            </div>
            <div class="menu-item dropdown">
                <span data-toggle="dropdown">Cari <i class="fa fa-caret-down"></i></span>
                <ul class="dropdown-menu tebeos-dropdown">
                    <li><a href="#" data-toggle="modal" data-target="#customerModal" onclick="$(this).getCustomerOrders()">Müşteri Listesi</a></li>
                    <li><a href="#" data-toggle="modal" data-target="#newCustomer">Yeni Müşteri</a></li>
                </ul>
            </div>
            <div class="menu-item dropdown">
                <span data-toggle="dropdown">Raporlar <i class="fa fa-caret-down"></i></span>
                <ul class="dropdown-menu tebeos-dropdown">
                    <li><a href="#" id="reports-daily">Günlük Rapor</a></li>
                    <li><a href="#" id="reports-transactions">İşlem Raporu</a></li>
                    <li><a href="#" id="reports-products">Ürün Satış Raporu</a></li>
                </ul>
            </div>
            <div class="menu-item dropdown p_four">
                <span data-toggle="dropdown">Kullanıcılar <i class="fa fa-caret-down"></i></span>
                <ul class="dropdown-menu tebeos-dropdown">
                    <li><a href="#" data-toggle="modal" data-target="#Users">Kullanıcı Listesi</a></li>
                    <li><a href="#" id="add-user" data-toggle="modal">Yeni Kullanıcı</a></li>
                </ul>
            </div>
            <div class="menu-item dropdown p_five">
                <span data-toggle="dropdown">Ayarlar <i class="fa fa-caret-down"></i></span>
                <ul class="dropdown-menu tebeos-dropdown">
                    <li><a href="#" data-toggle="modal" data-target="#settingsModal">Genel Ayarlar</a></li>
                    <li><a href="#" id="cashier">Profilim</a></li>
                </ul>
            </div>
            <div class="menu-item dropdown">
                <span data-toggle="dropdown">Yardım <i class="fa fa-caret-down"></i></span>
                <ul class="dropdown-menu tebeos-dropdown">
                    <li><a href="#">Hakkında</a></li>
                    <li><a href="#">Kılavuz</a></li>
                </ul>
            </div>
        </div>

        <!-- TEBEOS Toolbar (Like original TEBEOS) -->
        <div class="tebeos-toolbar">
            <div class="toolbar-btn" id="pointofsale">
                <i class="fa fa-money btn-icon"></i>
                <span class="btn-label">Nakit Satış</span>
            </div>
            <div class="toolbar-btn p_three" id="transactions">
                <i class="fa fa-list-alt btn-icon"></i>
                <span class="btn-label">Tüm Satışlar</span>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-btn" data-toggle="modal" data-target="#holdOrdersModal">
                <i class="fa fa-clock-o btn-icon"></i>
                <span class="btn-label">Açık Sekmeler</span>
            </div>
            <div class="toolbar-btn" data-toggle="modal" data-target="#customerModal" onclick="$(this).getCustomerOrders()">
                <i class="fa fa-shopping-basket btn-icon"></i>
                <span class="btn-label">Siparişler</span>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-btn p_one" data-toggle="modal" data-target="#Products">
                <i class="fa fa-database btn-icon"></i>
                <span class="btn-label">Ürün Listesi</span>
            </div>
            <div class="toolbar-btn p_one" data-toggle="modal" data-target="#newProduct">
                <i class="fa fa-plus-circle btn-icon"></i>
                <span class="btn-label">Ürün Ekle</span>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-btn p_two" data-toggle="modal" data-target="#Categories">
                <i class="fa fa-th-large btn-icon"></i>
                <span class="btn-label">Kategoriler</span>
            </div>
            <div class="toolbar-btn" data-toggle="modal" data-target="#newCustomer">
                <i class="fa fa-user-plus btn-icon"></i>
                <span class="btn-label">Yeni Müşteri</span>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-btn p_five" data-toggle="modal" data-target="#settingsModal">
                <i class="fa fa-cog btn-icon"></i>
                <span class="btn-label">Ayarlar</span>
            </div>
        </div>

        <!-- TEBEOS MDI Workspace -->
        <div class="tebeos-workspace" style="position: relative; flex: 1; overflow: hidden;">
            <!-- MDI Container - Pencereler burada acilir -->
            <div class="mdi-container" id="mdi-container"></div>

            <!-- Dashboard Content (arka plan) -->
            <div class="tebeos-content" style="height: 100%; overflow-y: auto;">
            <div class="container-fluid p-0">
            <div id="transactions_view">
                <div class="container-fluid">
                    <!-- TEBEOS Style Dashboard Widgets (2 rows like original) -->
                    <div class="tebeos-widget-grid" id="totals">
                        <!-- Row 1 -->
                        <div class="tebeos-widget" id="total_sales" onclick="$('#transactions').click();">
                            <div class="widget-header">
                                <i class="fa fa-money widget-icon"></i>
                                <span class="widget-title">Günlük Kasa</span>
                            </div>
                            <div class="widget-content">
                                Nakit Tahsi: <strong><span id="counter">0</span> TL</strong><br>
                                Pos Tahsi: <strong>0 TL</strong>
                            </div>
                        </div>
                        <div class="tebeos-widget widget-warning" id="total_transactions">
                            <div class="widget-header">
                                <i class="fa fa-exchange widget-icon"></i>
                                <span class="widget-title">Sipariş İşlemleri</span>
                            </div>
                            <div class="widget-content">
                                Günlük Sipariş: <strong><span id="counter">0</span> Adet</strong><br>
                                Genel Sipariş: <strong>0 Adet</strong>
                            </div>
                        </div>
                        <div class="tebeos-widget" id="total_items" onclick="$('#holdOrdersModal').modal('show');">
                            <div class="widget-header">
                                <i class="fa fa-clock-o widget-icon"></i>
                                <span class="widget-title">Açık Sekmeler</span>
                            </div>
                            <div class="widget-content">
                                Bekleyen: <strong><span id="counter">0</span> Adet</strong><br>
                                <small>Tıklayarak görüntüle</small>
                            </div>
                        </div>
                        <div class="tebeos-widget widget-success" id="total_products">
                            <div class="widget-header">
                                <i class="fa fa-database widget-icon"></i>
                                <span class="widget-title">Stok Durumu</span>
                            </div>
                            <div class="widget-content">
                                Toplam Ürün: <strong><span id="counter">0</span> Adet</strong><br>
                                <small>Sistemdeki ürünler</small>
                            </div>
                        </div>
                    </div>

                    <!-- Row 2 - Additional Widgets -->
                    <div class="tebeos-widget-grid">
                        <div class="tebeos-widget widget-danger" data-toggle="modal" data-target="#Products">
                            <div class="widget-header">
                                <i class="fa fa-warning widget-icon"></i>
                                <span class="widget-title">Stok Uyarıları</span>
                            </div>
                            <div class="widget-content">
                                Kritik Stok: <strong>0 Adet</strong><br>
                                <small>Minimum stok altında</small>
                            </div>
                        </div>
                        <div class="tebeos-widget" data-toggle="modal" data-target="#customerModal" onclick="$(this).getCustomerOrders()">
                            <div class="widget-header">
                                <i class="fa fa-users widget-icon"></i>
                                <span class="widget-title">Müşteriler</span>
                            </div>
                            <div class="widget-content">
                                Toplam Müşteri: <strong>0</strong><br>
                                <small>Kayıtlı müşteriler</small>
                            </div>
                        </div>
                        <div class="tebeos-widget widget-warning" data-toggle="modal" data-target="#Categories">
                            <div class="widget-header">
                                <i class="fa fa-th-large widget-icon"></i>
                                <span class="widget-title">Kategoriler</span>
                            </div>
                            <div class="widget-content">
                                Toplam Kategori: <strong>0</strong><br>
                                <small>Ürün kategorileri</small>
                            </div>
                        </div>
                        <div class="tebeos-widget widget-success" id="pointofsale-widget">
                            <div class="widget-header">
                                <i class="fa fa-shopping-cart widget-icon"></i>
                                <span class="widget-title">Hızlı Satış</span>
                            </div>
                            <div class="widget-content">
                                <strong>Satış Ekranına Git</strong><br>
                                <small>Yeni satış başlat</small>
                            </div>
                        </div>
                    </div>

                    <!-- TEBEOS Style Filter Bar -->
                    <div class="tebeos-table-container m-b-20">
                        <div class="tebeos-table-title">
                            <i class="fa fa-filter"></i> İşlem Filtreleri
                        </div>
                        <div class="p-15" style="padding: 15px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                            <div class="input-group" style="width: auto;">
                                <span class="input-group-addon" id="till-addon">Kasa</span>
                                <select id="tills" class="form-control" aria-describedby="till-addon" style="min-width: 120px;">
                                </select>
                            </div>
                            <div class="input-group" style="width: auto;">
                                <span class="input-group-addon" id="cashier-addon">Kasiyer</span>
                                <select id="users" class="form-control" aria-describedby="cashier-addon" style="min-width: 120px;">
                                </select>
                            </div>
                            <div class="input-group" style="width: auto;">
                                <span class="input-group-addon" id="status-addon">Durum</span>
                                <select id="status" class="form-control" aria-describedby="" style="min-width: 120px;">
                                    <option value="1">Ödendi</option>
                                    <option value="0">Ödenmedi</option>
                                </select>
                            </div>
                            <div class="input-group" style="width: auto;">
                                <span class="input-group-addon" id="date-addon"><i class="fa fa-calendar"></i> Tarih</span>
                                <div id="reportrange" style="min-width: 200px;">
                                    <span></span>&nbsp;<i class="fa fa-caret-down"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- TEBEOS Style Tables -->
                    <div class="row">
                        <div class="col-md-4" id="productSales">
                            <div class="tebeos-table-container">
                                <div class="tebeos-table-title">
                                    <i class="fa fa-bar-chart"></i> Satılan Ürünler
                                </div>
                                <div style="max-height: 400px; overflow-y: auto;">
                                    <table class="tebeos-table" id="productsSold">
                                        <thead>
                                            <tr>
                                                <th>Ad</th>
                                                <th>Satılan</th>
                                                <th>Mevcut</th>
                                                <th>Satış</th>
                                            </tr>
                                        </thead>
                                        <tbody id="product_sales"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8" id="transactionDetails">
                            <div class="tebeos-table-container">
                                <div class="tebeos-table-title">
                                    <i class="fa fa-list-alt"></i> İşlem Detayları
                                </div>
                                <div style="max-height: 400px; overflow-y: auto;">
                                    <table class="tebeos-table" id="transactionList">
                                        <thead>
                                            <tr>
                                                <th>Fatura</th>
                                                <th>Tarih</th>
                                                <th>Toplam</th>
                                                <th>Ödenen</th>
                                                <th>Para Üstü</th>
                                                <th>Yöntem</th>
                                                <th>Kasa</th>
                                                <th>Kasiyer</th>
                                                <th>İşlem</th>
                                            </tr>
                                        </thead>
                                        <tbody id="transaction_list"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="pos_view">
                <div class="row m-t-20">
                    <div class="col-md-6">
                        <div class="card-box" id="card-box">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <select name="" id="customer" class="form-control">
                                            </select>
                                            <span class="input-group-btn">
                                                <button id="newCustomerModal" data-toggle="modal" data-target="#newCustomer" class="btn btn-success"><i class="fa fa-plus"></i></button>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-md-10 m-t-5">
                                        <form action="" id="searchBarCode">
                                            <div class="input-group">
                                                <input type="text" required id="skuCode" name="skuCode" class="form-control number-input" placeholder="Barkod okutun veya numarayı yazıp enter'a basın" aria-label="barcode" aria-describedby="basic-addon2">
                                                <span class="input-group-btn">
                                                    <button type="submit" class="btn btn-default search-barcode-btn"><i class="glyphicon glyphicon-ok"></i></button>
                                                </span>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="row p-t-10" id="cartTable">
                                    <div class="card-box">
                                        <div class="card-title">
                                            <div class="row">
                                                <div class="col-md-1"><strong>#</strong></div>
                                                <div class="col-md-3"><strong>Ürün</strong></div>
                                                <div class="col-md-3"><strong>Adet</strong></div>
                                                <div class="col-md-3"><strong>Fiyat</strong></div>
                                                <div class="col-md-1"><button onclick="$(this).cancelOrder()" class="btn btn-light btn-xs"><i class="fa fa-times"></i></button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body"></div>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="m-t-5">
                                <div class="row">
                                    <div class="col-md-3">Toplam Ürün</div>
                                    <div class="col-md-3">: <span id="total">0</span>
                                    </div>
                                    <div class="col-md-3">Fiyat :</div>
                                    <div class="col-md-3">: <span id="price">0.0</span></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3">İndirim</div>
                                    <div class="col-md-3"><input class="form-control" type="number" id="inputDiscount" minimum="0" placeholder="tutar" oninput="$(this).calculateCart();"></div>
                                    <div class="col-md-3">Brüt Fiyat (%<span id="taxInfo"></span> KDV dahil)</div>
                                    <div class="col-md-3">
                                        <h3 id="gross_price">0.00</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="button-list pull-right">
                                <button onclick="$(this).submitDueOrder(3);" type="button" class="btn btn-info waves-effect waves-light">
                                    <i class="fa fa-print"></i>
                                </button>
                                <button onclick="$(this).cancelOrder()" type="button" class="btn btn-danger waves-effect waves-light">
                                    <span class="btn-label"><i class="fa fa-ban"></i></span>İptal
                                </button>
                                <button type="button" id="hold" class="btn btn-info waves-effect waves-light">
                                    <span class="btn-label"><i class="fa fa-hand-paper-o"></i></span>Beklet
                                </button>
                                <button type="button" id="payButton" class="btn btn-success waves-effect waves-light">
                                    <span class="btn-label"><i class="fa fa-money"></i></span>Öde
                                </button>
                            </div>
                            <hr>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card-box">
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="text" id="search" class="form-control" placeholder="Ürün adı veya SKU ile ara">
                                </div>
                                <div class="col-md-6">
                                    <select id="categories" class="form-control">
                                    </select>
                                </div>
                            </div>
                            <hr>
                            <div class="row" id="parent">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div><!-- end container-fluid -->
        </div><!-- end tebeos-content -->
        </div><!-- end tebeos-workspace -->

        <!-- TEBEOS Footer -->
        <div class="tebeos-footer">
            <div><i class="fa fa-clock-o"></i> <span id="current-time"></span></div>
            <div class="brand">EczaPlus - Eczane Yönetiminde Yardımcınız</div>
            <div><i class="fa fa-desktop"></i> v1.0.0</div>
        </div>

        <div id="dueModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="mySmallModalLabel">Siparişi Beklet
                        </h4>
                    </div>
                    <div class="modal-body">
                        <form action="">
                            <input type="text" id="refNumber" placeholder="Referans girin" class="form-control">
                        </form>
                        <hr>
                        <div class="row">
                            <div class="col-md-4">
                                <button data-val="1" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">1</button>
                            </div>
                            <div class="col-md-4">
                                <button data-val="2" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">2</button>
                            </div>
                            <div class="col-md-4">
                                <button data-val="3" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">3</button>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-4">
                                <button data-val="4" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">4</button>
                            </div>
                            <div class="col-md-4">
                                <button data-val="5" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">5</button>
                            </div>
                            <div class="col-md-4">
                                <button data-val="6" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">6</button>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-4">
                                <button data-val="7" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">7</button>
                            </div>
                            <div class="col-md-4">
                                <button data-val="8" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">8</button>
                            </div>
                            <div class="col-md-4">
                                <button data-val="9" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">9</button>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-4">
                                <button data-val="del" class="btn btn-warning btn-lg btn-block">⌫</button>
                            </div>
                            <div class="col-md-4">
                                <button data-val="0" data-isdue="true" class="btn btn-success btn-lg btn-block keypad-btn">0</button>
                            </div>
                            <div class="col-md-4">
                                <button data-val="ac" data-isdue="true" class="btn btn-danger btn-lg btn-block keypad-btn">AC</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" onclick="$(this).submitDueOrder(0);" class="btn btn-primary btn-block btn-lg waves-effect waves-light">Siparişi Beklet</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <!--  Modal content for the above example -->
        <div id="paymentModel" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="myLargeModalLabel">Ödeme</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="list-group">
                                    <a href="javascript:void(0)" data-payment-method="Nakit" data-payment-type="1" class="list-group-item active">
                                        Nakit
                                    </a>
                                    <a href="javascript:void(0)" data-payment-method="Kart" data-payment-type="3" class="list-group-item">Kart</a>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon3">Fiyat <span id="price_curr"></span></span>
                                    <input id="payablePrice" readonly type="text" class="form-control" aria-describedby="basic-addon3">
                                </div>
                                <br>
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon3">Ödeme <span id="payment_curr"></span> </span>
                                    <input type="text" placeholder="0.0" class="form-control" id="paymentText" aria-describedby="basic-addon3" readonly>
                                    <input type="hidden" class="form-control" id="payment" aria-describedby="basic-addon3">
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-md-9">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <button data-val="1" data-isdue="false" class="btn btn-success btn-lg btn-block keypad-btn">1</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button data-val="2" data-isdue="false" class="btn btn-success btn-lg btn-block keypad-btn">2</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button data-val="3" data-isdue="false" class="btn btn-success btn-lg btn-block keypad-btn">3</button>
                                            </div>
                                            <div class="col-md-3"></div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <button data-val="4" data-isdue="false" class="btn btn-success btn-lg btn-block keypad-btn">4</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button data-val="5" data-isdue="false" class="btn btn-success btn-lg btn-block keypad-btn">5</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button data-val="6" data-isdue="false" class="btn btn-success btn-lg btn-block keypad-btn">6</button>
                                            </div>
                                            <div class="col-md-3"></div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <button data-val="7" data-isdue="false" class="btn btn-success btn-lg btn-block keypad-btn">7</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button data-val="8" data-isdue="false" class="btn btn-success btn-lg btn-block keypad-btn">8</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button data-val="9" data-isdue="false" class="btn btn-success btn-outline-success btn-lg btn-block keypad-btn">9</button>
                                            </div>
                                            <div class="col-md-3"></div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <button data-val="del" class="btn btn-danger btn-lg btn-block keypad-btn">⌫</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button data-val="0" data-isdue="false" class="btn btn-success btn-lg btn-block keypad-btn">0</button>
                                            </div>
                                            <div class="col-md-3">
                                                <button data-val="." data-isdue="false" class="btn btn-warning btn-lg btn-block">.</button>
                                            </div>
                                            <div class="col-md-3"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <button data-val="ac" data-isdue="false" class="btn btn-danger btn-block btn-lg keypad-btn">AC</button>
                                    </div>
                                </div>
                                <br>
                                <div class="input-group" id="cardInfo">
                                    <span class="input-group-addon" id="basic-addon3">Kart Bilgisi </span>
                                    <input type="text" class="form-control" id="paymentInfo" aria-describedby="basic-addon3">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="btn btn-primary btn-block btn-lg waves-effect waves-light">Para Üstü <span id="change_curr"></span><span id="change"></span> </div>
                            </div>
                            <div class="col-md-6">
                                <button type="button" id="confirmPayment" class="btn btn-success btn-block btn-lg waves-effect waves-light">Ödemeyi
                                Onayla</button>
                            </div>
                        </div>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <div id="newCustomer" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="mySmallModalLabel">Yeni Müşteri
                        </h4>
                    </div>
                    <div class="modal-body">
                        <form id="saveCustomer" data-parsley-validate>
                            <div class="form-group">
                                <label for="userName">Müşteri Adı*</label>
                                <input type="text" required="required" name="name" parsley-trigger="change" placeholder="Ad girin" class="form-control" id="userName">
                            </div>
                            <div class="form-group">
                                <label for="userName">Müşteri Telefonu</label>
                                <input type="text" name="phone" parsley-trigger="change" placeholder="Telefon numarası girin" class="form-control" id="phoneNumber">
                            </div>
                            <div class="form-group">
                                <label for="userName">Müşteri E-postası</label>
                                <input type="email" name="email" parsley-trigger="change" placeholder="E-posta adresi girin" class="form-control" id="emailAddress">
                            </div>
                            <div class="form-group">
                                <label for="userName">Müşteri Adresi</label>
                                <input type="text" name="address" parsley-trigger="change" placeholder="Adres girin" class="form-control" id="userAddress">
                            </div>
                            <input type="submit" class="btn btn-primary btn-block waves-effect waves-light">
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div id="newProduct" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="mySmallModalLabel">Ürün
                        </h4>
                    </div>
                    <div class="modal-body">
                        <form id="saveProduct" encType="multipart/form-data">
                            <input type="hidden" name="id" id="product_id">
                            <input type="hidden" name="img" id="img">
                            <input type="hidden" name="remove" id="remove_img">
                            <div class="form-group">
                                <label for="category">Kategori</label>
                                <select name="category" class="form-control" id="category"></select>
                            </div>
                            <div class="form-group">
                                <label for="productName">Ürün Adı</label>
                                <input type="text" required="required" name="name" parsley-trigger="change" placeholder="Ürün adı girin" class="form-control" id="productName">
                            </div>
                            <div class="form-group">
                                <label for="barcode">Barkod</label>
                                <input type="text" required="required" name="barcode" parsley-trigger="change" placeholder="Ürün barkodunu girin" class="form-control number-input" id="barcode">
                            </div>
                            <div class="form-group">
                                <label for="product_price">Fiyat</label>
                                <input type="text" required="required" name="price" placeholder="Fiyat" class="form-control number-input" id="product_price">
                            </div>
                            <div class="form-group">
                                <label for="expirationDate">Son Kullanma Tarihi</label>
                                <input type="text" name="expirationDate" parsley-trigger="change" placeholder="gg/aa/yyyy" class="form-control" id="expirationDate" readonly>
                            </div>
                            <div class="form-group">
                                <label for="quantity">Stok</label>
                                <input type="number" name="quantity" placeholder="Mevcut stok" class="form-control" id="quantity" min="0">
                            </div>
                            <div class="form-group">
                                <label for="quantity">Minimum Stok</label>
                                <input type="number" name="minStock" placeholder="Minimum Stok" class="form-control" id="minStock" min="1">
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="stock" id="stock"> Stok kontrolünü devre dışı bırak </label>
                            </div>
                            <div class="form-group">
                                <label for="imagename"><span id="rmv_img" class="btn btn-xs btn-warning">Kaldır</span>
                                Resim </label>
                                <div id="current_img"></div>
                                <input type="file" name="imagename" id="imagename">
                            </div>
                            <input type="submit" id="submitProduct" class="btn btn-primary btn-block waves-effect waves-light">
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div id="newCategory" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="mySmallModalLabel">Kategori
                        </h4>
                    </div>
                    <div class="modal-body">
                        <form id="saveCategory">
                            <div class="form-group">
                                <label for="userName">Ad</label>
                                <input id="category_id" type="hidden" name="id">
                                <input id="categoryName" type="text" required="required" name="name" placeholder="Kategori adı girin" class="form-control">
                            </div>
                            <input type="submit" id="submitCategory" class="btn btn-primary btn-block waves-effect waves-light">
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div id="Products" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="mySmallModalLabel">Ürünler
                        </h4>
                    </div>
                    <div class="modal-body p-20 p-r-40" id="all_products">
                        <table class="table table-bordered" id="productList">
                            <thead>
                                <tr>
                                    <th>Barkod</th>
                                    <th>Ürün</th>
                                    <th>Ad</th>
                                    <th>Fiyat</th>
                                    <th>Stok</th>
                                    <th>Son Kullanma Tarihi</th>
                                    <th>Kategori</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="product_list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="Users" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="mySmallModalLabel">Kullanıcılar
                        </h4>
                    </div>
                    <div class="modal-body p-20 p-r-20" id="all_userss">
                        <table class="table table-bordered" id="userList">
                            <thead>
                                <tr>
                                    <th>Ad</th>
                                    <th>Kullanıcı Adı</th>
                                    <th>Durum</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="user_list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="Categories" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="mySmallModalLabel">Kategoriler
                        </h4>
                    </div>
                    <div class="modal-body">
                        <table class="table table-bordered" id="categoryList">
                            <thead>
                                <tr>
                                    <th>Ad</th>
                                    <th>İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="category_list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="userModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="mySmallModalLabel">Hesap Bilgileri
                        </h4>
                    </div>
                    <div class="modal-body">
                        <form id="saveUser" data-parsley-validate>
                            <input type="hidden" name="id" id="user_id">
                            <div class="form-group">
                                <label for="userName">Ad*</label>
                                <input type="text" required="required" name="fullname" parsley-trigger="change" placeholder="Ad girin" class="form-control" id="fullname">
                            </div>
                            <div class="form-group">
                                <label for="userName">Kullanıcı Adı*</label>
                                <input type="text" name="username" parsley-trigger="change" placeholder="Giriş Kullanıcı Adı" class="form-control" id="username">
                            </div>
                            <div class="form-group">
                                <label for="userName">Şifre</label>
                                <input type="password" name="password" parsley-trigger="change" placeholder="Şifre" class="form-control" id="password">
                            </div>
                            <div class="form-group">
                                <label for="userName">Şifre Tekrar</label>
                                <input type="password" name="pass" parsley-trigger="change" placeholder="Tekrar" class="form-control" id="pass">
                            </div>
                            <div class="perms">
                                <h3 class="m-t-20">İzinler</h3>
                                <hr>
                                <div class="form-group">
                                    <span><input type="checkbox" name="perm_products" id="perm_products"> Ürün ve
                                    Stok Yönetimi </span>
                                </div>
                                <div class="form-group">
                                    <span><input type="checkbox" name="perm_categories" id="perm_categories"> Ürün
                                    Kategorileri Yönetimi </span>
                                </div>
                                <div class="form-group">
                                    <span><input type="checkbox" name="perm_transactions" id="perm_transactions"> İşlemleri
                                    Görüntüle </span>
                                </div>
                                <div class="form-group">
                                    <span><input type="checkbox" name="perm_users" id="perm_users"> Kullanıcı ve
                                    İzin Yönetimi </span>
                                </div>
                                <div class="form-group">
                                    <span><input type="checkbox" name="perm_settings" id="perm_settings"> Ayarları
                                    Yönet </span>
                                </div>
                            </div>
                            <input type="submit" class="btn btn-primary btn-block waves-effect waves-light">
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div id="holdOrdersModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="myLargeModalLabel">Açık Siparişler</h4>
                    </div>
                    <div class="modal-body">
                        <input type="text" id="holdOrderInput" placeholder="Referansa göre sipariş ara" class="holdOrderInput form-control">
                        <div class="holdOrderKeyboard"></div>
                        <br>
                        <div class="row" id="renderHoldOrders">
                            <p>Lütfen bekleyin <span class="dot"></span> </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="customerModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="myLargeModalLabel">Müşteri Siparişleri</h4>
                    </div>
                    <div class="modal-body">
                        <input type="text" id="holdCustomerOrderInput" placeholder="Müşteri adına göre sipariş ara" class="holdCustomerOrderInput form-control">
                        <div class="customerOrderKeyboard"></div>
                        <br>
                        <div class="row" id="renderCustomerOrders">
                            <p>Lütfen bekleyin <span class="dot"></span> </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="orderModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button class="btn btn-sm btn-success" onclick="$(this).print()">Yazdır</button> <br> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    </div>
                    <div class="modal-body" id="viewTransaction">
                    </div>
                    <div class="alert alert-danger">Yazdırma iptalinden sonra takılırsanız sağ tıklayıp yenileyin.
                    </div>
                </div>
            </div>
        </div>
        <div id="settingsModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="mySmallModalLabel">Ayarlar
                        </h4>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="row">
                                <div class="form-group">
                                    <label for="app">Uygulama</label>
                                    <select name="app" id="app" class="form-control">
                                        <option value="Standalone Point of Sale">Bağımsız Satış Noktası</option>
                                        <option value="Network Point of Sale Terminal">Ağ Satış Noktası Terminali</option>
                                        <option value="Network Point of Sale Server">Ağ Satış Noktası Sunucusu</option>
                                    </select>
                                </div>
                                <form id="net_settings_form">
                                    <div class="form-group">
                                        <label for="ip">Sunucu IP Adresi*</label>
                                        <input type="text" required="required" placeholder="Yönetici bilgisayarının IP adresini girin." name="ip" class="form-control" id="ip">
                                    </div>
                                    <div class="col-md-5">
                                        <div class="form-group">
                                            <label for="till">Kasa Numarası*</label>
                                            <input type="text" required="required" placeholder="Numara girin" name="till" class="form-control" id="till">
                                        </div>
                                    </div>
                                    <div class="col-md-7">
                                        <div class="form-group">
                                            <label for="mac">Donanım Kimlik Numarası </label>
                                            <input type="text" required="required" name="mac" class="form-control" id="mac" readonly="readonly">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <input id="save_settings" type="submit" class="btn btn-success btn-block waves-effect waves-light" value="Ayarları Kaydet">
                                    </div>
                                </form>
                            </div>
                            <form id="settings_form" encType="multipart/form-data">
                                <input type="hidden" name="id" id="settings_id">
                                <input type="hidden" name="img" id="logo_img">
                                <input type="hidden" name="remove" id="remove_logo">
                                <div class="container">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="userName">Mağaza Adı</label>
                                            <input type="text" required="required" name="store" class="form-control" id="store" placeholder="Eczane Adı">
                                        </div>
                                        <div class="form-group">
                                            <label for="userName">Adres Satırı 1</label>
                                            <input type="text" required="required" name="address_one" class="form-control" id="address_one" placeholder="Ana Cadde 123, Bina No">
                                        </div>
                                        <div class="form-group">
                                            <label for="userName">Adres Satırı 2</label>
                                            <input type="text" required="required" name="address_two" class="form-control" id="address_two" placeholder="Şehir, Ülke">
                                        </div>
                                        <div class="form-group">
                                            <label for="userName">İletişim Numarası</label>
                                            <input type="tel" name="contact" class="form-control" id="contact" placeholder="0312 123 4567">
                                        </div>
                                        <div class="form-group">
                                            <label for="userName">KDV Numarası</label>
                                            <input type="text" name="tax" parsley-trigger="change" class="form-control number-input" id="tax">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="userName">Para Birimi Simgesi</label>
                                            <input type="text" required="required" name="symbol" class="form-control" id="symbol" minlength="1" maxlength="3" placeholder="TL">
                                        </div>
                                        <div class="form-group">
                                            <label for="userName">KDV Yüzdesi</label>
                                            <div class="pull-left">
                                                <div class="col-md-6">
                                                    <div class="input-group" style="width:130%">
                                                        <input type="number" min="0" max="100" required="required" name="percentage" class="form-control" id="percentage">
                                                        <span class="input-group-addon">%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <br><br>
                                        <div class="form-group">
                                            <label><input type="checkbox" name="charge_tax" id="charge_tax"> KDV
                                            Uygula</label>
                                        </div>
                                        <div class="form-group">
                                            <label for="userName"><span id="rmv_logo" class="btn btn-xs btn-warning">Kaldır</span> Logo </label>
                                            <div id="current_logo"></div>
                                            <input type="file" name="imagename" id="logoname" accept=".jpg,.jpeg,.png,.webp">
                                            <small class="text-gray">
                                            Maks dosya boyutu: <strong>2MB</strong>; İzin verilen resim türleri:<strong> jpeg, jpg, png veya webp</strong></small>

                                        </div>
                                        <div class="form-group">
                                            <label for="userName">Fiş Alt Bilgisi</label>
                                            <textarea name="footer" class="form-control" id="footer"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <input id="save_settings" type="submit" class="btn btn-success btn-block waves-effect waves-light" value="Ayarları Kaydet">
                                </div>
                            </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="assets/dist/js/bundle.min.js"></script>
    <script>
        // Global API port - iframe'ler bu degiskene erisebilir
        window.API_PORT = (typeof process !== 'undefined' && process.env && process.env.PORT) ? process.env.PORT : '3000';
        window.API_BASE = 'http://localhost:' + window.API_PORT;
        console.log('Global API Port:', window.API_PORT);

        // =============================================
        // MDI WINDOW MANAGER - Coklu Pencere Sistemi
        // =============================================
        const MDI = {
            windows: new Map(),
            windowCounter: 0,
            zIndexCounter: 100,
            cascadeOffset: 0,
            activeWindow: null,

            // Pencere konfigurasyonlari
            configs: {
                'pos': { title: 'Nakit Satis', icon: 'fa-money', width: 900, height: 600, url: 'windows/pos-window.html' },
                'products': { title: 'Urun Listesi', icon: 'fa-database', width: 850, height: 550, url: 'windows/products-window.html' },
                'transactions': { title: 'Islem Listesi', icon: 'fa-list-alt', width: 900, height: 550, url: 'windows/transactions-window.html' },
                'customers': { title: 'Musteri Listesi', icon: 'fa-users', width: 750, height: 500, url: 'windows/customers-window.html' },
                'categories': { title: 'Kategoriler', icon: 'fa-th-large', width: 600, height: 450, url: 'windows/categories-window.html' },
                'new-product': { title: 'Yeni Urun', icon: 'fa-plus-circle', width: 550, height: 600, url: 'windows/new-product-window.html' },
                'new-customer': { title: 'Yeni Musteri', icon: 'fa-user-plus', width: 480, height: 450, url: 'windows/new-customer-window.html' },
                'settings': { title: 'Ayarlar', icon: 'fa-cog', width: 700, height: 550, url: 'windows/settings-window.html' }
            },

            // Yeni pencere olustur
            createWindow: function(type) {
                const config = this.configs[type];
                if (!config) return null;

                this.windowCounter++;
                const windowId = type + '-' + this.windowCounter;

                // Cascade pozisyonu hesapla
                this.cascadeOffset = (this.cascadeOffset + 1) % 10;
                const offsetX = 30 + (this.cascadeOffset * 25);
                const offsetY = 30 + (this.cascadeOffset * 25);

                // Pencere HTML olustur
                const windowEl = document.createElement('div');
                windowEl.className = 'mdi-window';
                windowEl.id = windowId;
                windowEl.style.cssText = `left: ${offsetX}px; top: ${offsetY}px; width: ${config.width}px; height: ${config.height}px; z-index: ${++this.zIndexCounter};`;

                // API portunu URL'e ekle
                const apiPort = typeof process !== 'undefined' ? process.env.PORT : '3000';
                const urlWithPort = config.url + '?port=' + apiPort;

                windowEl.innerHTML = `
                    <div class="mdi-window-titlebar" onmousedown="MDI.startDrag(event, '${windowId}')">
                        <i class="fa ${config.icon} window-icon"></i>
                        <span class="window-title">${config.title} #${this.windowCounter}</span>
                        <div class="window-controls">
                            <button class="btn-minimize" onclick="MDI.minimizeWindow('${windowId}')" title="Simge Durumuna Kucult"><i class="fa fa-minus"></i></button>
                            <button class="btn-maximize" onclick="MDI.maximizeWindow('${windowId}')" title="Ekrani Kapla"><i class="fa fa-square-o"></i></button>
                            <button class="btn-close" onclick="MDI.closeWindow('${windowId}')" title="Kapat"><i class="fa fa-times"></i></button>
                        </div>
                    </div>
                    <div class="mdi-window-content">
                        <iframe src="${urlWithPort}" frameborder="0"></iframe>
                    </div>
                    <div class="mdi-window-resize" onmousedown="MDI.startResize(event, '${windowId}')"></div>
                `;

                document.getElementById('mdi-container').appendChild(windowEl);
                this.windows.set(windowId, { el: windowEl, config: config, minimized: false, maximized: false });
                this.activateWindow(windowId);
                this.updateTaskbar();

                return windowId;
            },

            // Pencereyi aktif yap
            activateWindow: function(windowId) {
                // Onceki aktif pencereyi pasif yap
                this.windows.forEach((win, id) => {
                    win.el.classList.remove('active');
                    win.el.classList.add('inactive');
                });

                const win = this.windows.get(windowId);
                if (win && !win.minimized) {
                    win.el.classList.add('active');
                    win.el.classList.remove('inactive');
                    win.el.style.zIndex = ++this.zIndexCounter;
                    this.activeWindow = windowId;
                }
                this.updateTaskbar();
            },

            // Pencereyi kapat
            closeWindow: function(windowId) {
                const win = this.windows.get(windowId);
                if (win) {
                    win.el.remove();
                    this.windows.delete(windowId);
                    this.updateTaskbar();
                }
            },

            // Pencereyi simge durumuna kucult
            minimizeWindow: function(windowId) {
                const win = this.windows.get(windowId);
                if (win) {
                    win.minimized = true;
                    win.el.classList.add('minimized');
                    this.updateTaskbar();
                }
            },

            // Pencereyi geri yukle
            restoreWindow: function(windowId) {
                const win = this.windows.get(windowId);
                if (win) {
                    win.minimized = false;
                    win.el.classList.remove('minimized');
                    this.activateWindow(windowId);
                }
            },

            // Pencereyi tam ekran yap/geri al
            maximizeWindow: function(windowId) {
                const win = this.windows.get(windowId);
                if (win) {
                    if (win.maximized) {
                        win.el.classList.remove('maximized');
                        win.el.style.cssText = win.prevStyle;
                        win.maximized = false;
                    } else {
                        win.prevStyle = win.el.style.cssText;
                        win.el.classList.add('maximized');
                        win.maximized = true;
                    }
                }
            },

            // Surukleme baslat
            startDrag: function(e, windowId) {
                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'I') return;

                const win = this.windows.get(windowId);
                if (!win || win.maximized) return;

                this.activateWindow(windowId);

                const rect = win.el.getBoundingClientRect();
                const offsetX = e.clientX - rect.left;
                const offsetY = e.clientY - rect.top;

                const onMouseMove = (e) => {
                    const container = document.getElementById('mdi-container').getBoundingClientRect();
                    let newX = e.clientX - offsetX - container.left;
                    let newY = e.clientY - offsetY - container.top;

                    // Sinirlar icinde tut
                    newX = Math.max(0, Math.min(newX, container.width - 100));
                    newY = Math.max(0, Math.min(newY, container.height - 30));

                    win.el.style.left = newX + 'px';
                    win.el.style.top = newY + 'px';
                };

                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                };

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            },

            // Boyutlandirma baslat
            startResize: function(e, windowId) {
                e.preventDefault();
                e.stopPropagation();

                const win = this.windows.get(windowId);
                if (!win || win.maximized) return;

                this.activateWindow(windowId);

                const startX = e.clientX;
                const startY = e.clientY;
                const startWidth = win.el.offsetWidth;
                const startHeight = win.el.offsetHeight;

                const onMouseMove = (e) => {
                    const newWidth = Math.max(300, startWidth + (e.clientX - startX));
                    const newHeight = Math.max(200, startHeight + (e.clientY - startY));
                    win.el.style.width = newWidth + 'px';
                    win.el.style.height = newHeight + 'px';
                };

                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                };

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            },

            // Taskbar guncelle
            updateTaskbar: function() {
                let taskbar = document.getElementById('mdi-taskbar');
                if (!taskbar) {
                    taskbar = document.createElement('div');
                    taskbar.className = 'mdi-taskbar';
                    taskbar.id = 'mdi-taskbar';
                    document.getElementById('mdi-container').appendChild(taskbar);
                }

                taskbar.innerHTML = '';
                this.windows.forEach((win, id) => {
                    const btn = document.createElement('button');
                    btn.className = 'mdi-taskbar-btn' + (id === this.activeWindow && !win.minimized ? ' active' : '');
                    btn.innerHTML = `<i class="fa ${win.config.icon}"></i><span>${win.config.title}</span>`;
                    btn.onclick = () => {
                        if (win.minimized) {
                            this.restoreWindow(id);
                        } else if (id === this.activeWindow) {
                            this.minimizeWindow(id);
                        } else {
                            this.activateWindow(id);
                        }
                    };
                    taskbar.appendChild(btn);
                });

                // Taskbar'i gizle/goster
                taskbar.style.display = this.windows.size > 0 ? 'flex' : 'none';
            }
        };

        // Pencere acma kisayolu
        function openMDIWindow(type) {
            MDI.createWindow(type);
        }

        // TEBEOS Style - Update footer time
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const dateStr = now.toLocaleDateString('tr-TR');
            const el = document.getElementById('current-time');
            if (el) el.textContent = dateStr + ' ' + timeStr;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Menu click handlers
        $(document).ready(function() {
            // =============================================
            // MDI PENCERE ACMA
            // =============================================

            // Nakit Satis
            $('#pointofsale-widget, #pointofsale-menu, #pos-menu-nakit, #pointofsale').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                openMDIWindow('pos');
            });

            // Urun Listesi
            $('[data-target="#Products"]').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                openMDIWindow('products');
            });

            // Yeni Urun
            $('[data-target="#newProduct"]').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                openMDIWindow('new-product');
            });

            // Kategoriler
            $('[data-target="#Categories"]').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                openMDIWindow('categories');
            });

            // Musteriler
            $('[data-target="#customerModal"]').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                openMDIWindow('customers');
            });

            // Yeni Musteri
            $('[data-target="#newCustomer"]').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                openMDIWindow('new-customer');
            });

            // Islemler/Raporlar
            $('#transactions-menu, #pos-menu-all, #reports-daily, #reports-transactions, #reports-products, #transactions').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                openMDIWindow('transactions');
            });

            // Ayarlar
            $('[data-target="#settingsModal"]').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                openMDIWindow('settings');
            });
        });
    </script>
</body>

</html>